(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{475:function(s,t,a){"use strict";a.r(t);var e=a(8),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-初识elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-初识elasticsearch"}},[s._v("#")]),s._v(" 1. 初识elasticsearch")]),s._v(" "),t("h3",{attrs:{id:"_1-1-概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-概念"}},[s._v("#")]),s._v(" 1.1 概念")]),s._v(" "),t("p",[s._v("什么是"),t("strong",[s._v("elasticsearch")]),s._v("？")]),s._v(" "),t("ul",[t("li",[s._v("一个开源的分布式搜索引擎，可以用来实现搜索、日志统计、分析、系统监控等功能")])]),s._v(" "),t("blockquote",[t("p",[s._v("elasticsearch底层是基于"),t("strong",[s._v("lucene")]),s._v("来实现的")])]),s._v(" "),t("p",[s._v("什么是"),t("strong",[s._v("elastic stack")]),s._v("（ELK）？")]),s._v(" "),t("ul",[t("li",[s._v("是以elasticsearch为核心的技术栈，包括beats、Logstash、kibana、elasticsearch")])]),s._v(" "),t("p",[s._v("什么是"),t("strong",[s._v("Lucene")]),s._v("？")]),s._v(" "),t("ul",[t("li",[s._v("是Apache的开源搜索引擎类库，提供了搜索引擎的核心API")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-倒排索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-倒排索引"}},[s._v("#")]),s._v(" 1.2 倒排索引")]),s._v(" "),t("blockquote",[t("p",[s._v("倒排索引的概念是基于MySQL这样的正向索引而言的")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-基本介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-基本介绍"}},[s._v("#")]),s._v(" 1.2.1 基本介绍")]),s._v(" "),t("p",[s._v("倒排索引中有两个非常重要的概念：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("文档")]),s._v("（"),t("code",[s._v("Document")]),s._v("）：用来搜索的数据，其中的每一条数据就是一个文档。例如一个网页、一个商品信息")]),s._v(" "),t("li",[t("strong",[s._v("词条")]),s._v("（"),t("code",[s._v("Term")]),s._v("）：对文档数据或用户搜索数据，利用某种算法分词，得到的具备含义的词语就是词条。例如：我是中国人，就可以分为：我、是、中国人、中国、国人这样的几个词条")])]),s._v(" "),t("p",[t("strong",[s._v("创建倒排索引")]),s._v("是对正向索引的一种特殊处理，流程如下：\n"),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource@gh-pages/image/image-20210720201115192.2kzzmmxzcf40.webp",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("将每一个文档的数据利用算法分词，得到一个个词条")]),s._v(" "),t("li",[s._v("创建表，每行数据包括词条、词条所在文档id、位置等信息")]),s._v(" "),t("li",[s._v("因为词条唯一性，可以给词条创建索引，例如hash表结构索引")])]),s._v(" "),t("h4",{attrs:{id:"_1-2-2-正向和倒排"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-正向和倒排"}},[s._v("#")]),s._v(" 1.2.2 正向和倒排")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("正向索引")]),s._v("是最传统的，根据id索引的方式。但根据词条查询时，必须先逐条获取每个文档，然后判断文档中是否包含所需要的词条，是"),t("strong",[s._v("根据文档找词条的过程")]),s._v("。")]),s._v(" "),t("li",[s._v("而"),t("strong",[s._v("倒排索引")]),s._v("则相反，是先找到用户要搜索的词条，根据词条得到保护词条的文档的id，然后根据id获取文档。是"),t("strong",[s._v("根据词条找文档的过程")]),s._v("。")])]),s._v(" "),t("p",[s._v("那么两者方式的优缺点是什么呢？\n"),t("strong",[s._v("正向索引")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("优点：\n"),t("ul",[t("li",[s._v("可以给多个字段创建索引")]),s._v(" "),t("li",[s._v("根据索引字段搜索、排序速度非常快")])])]),s._v(" "),t("li",[s._v("缺点：\n"),t("ul",[t("li",[s._v("根据非索引字段，或者索引字段中的部分词条查找时，只能全表扫描。")])])])]),s._v(" "),t("p",[t("strong",[s._v("倒排索引")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("优点：\n"),t("ul",[t("li",[s._v("根据词条搜索、模糊搜索时，速度非常快")])])]),s._v(" "),t("li",[s._v("缺点：\n"),t("ul",[t("li",[s._v("只能给词条创建索引，而不是字段")]),s._v(" "),t("li",[s._v("无法根据字段做排序")])])])]),s._v(" "),t("h3",{attrs:{id:"_1-3-es的一些概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-es的一些概念"}},[s._v("#")]),s._v(" 1.3 es的一些概念")]),s._v(" "),t("h4",{attrs:{id:"_1-3-1-文档和字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-文档和字段"}},[s._v("#")]),s._v(" 1.3.1 文档和字段")]),s._v(" "),t("p",[s._v("elasticsearch 是面向"),t("strong",[s._v("文档（Document")]),s._v("存储的，可以是数据库中的一条商品数据，一个订单信息。文档数据会被序列化为json格式后存储在elasticsearch中：\n"),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource@gh-pages/image/image-20210720202707797.7kj2gq47x62o.webp",alt:""}}),s._v("\n而Json文档中往往包含很多的"),t("strong",[s._v("字段（Field）")]),s._v("，类似于数据库中的列。")]),s._v(" "),t("h4",{attrs:{id:"_1-3-2-索引和映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-索引和映射"}},[s._v("#")]),s._v(" 1.3.2.索引和映射")]),s._v(" "),t("p",[t("strong",[s._v("索引（Index）")]),s._v("，就是相同类型的文档的集合。")]),s._v(" "),t("p",[s._v("例如：")]),s._v(" "),t("ul",[t("li",[s._v("所有用户文档，就可以组织在一起，称为用户的索引；")]),s._v(" "),t("li",[s._v("所有商品的文档，可以组织在一起，称为商品的索引；")]),s._v(" "),t("li",[s._v("所有订单的文档，可以组织在一起，称为订单的索引；\n"),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource@gh-pages/image/image-20210720203022172.6gqf0ovmo0sg.webp",alt:""}})])]),s._v(" "),t("blockquote",[t("p",[s._v("因此，我们可以把索引当做是数据库中的表。")])]),s._v(" "),t("p",[s._v("数据库的表会有约束信息，用来定义表的结构、字段的名称、类型等信息。因此，索引库中就有"),t("strong",[s._v("映射（mapping）")]),s._v("，是索引中文档的字段约束信息，类似表的结构约束。")]),s._v(" "),t("h4",{attrs:{id:"_1-3-3-mysql与elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-mysql与elasticsearch"}},[s._v("#")]),s._v(" 1.3.3 mysql与elasticsearch")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[t("strong",[s._v("MySQL")])]),s._v(" "),t("th",[t("strong",[s._v("Elasticsearch")])]),s._v(" "),t("th",[t("strong",[s._v("说明")])])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Table")]),s._v(" "),t("td",[s._v("Index")]),s._v(" "),t("td",[s._v("索引(index)，就是文档的集合，类似数据库的表(table)")])]),s._v(" "),t("tr",[t("td",[s._v("Row")]),s._v(" "),t("td",[s._v("Document")]),s._v(" "),t("td",[s._v("文档（Document），就是一条条的数据，类似数据库中的行（Row），文档都是JSON格式")])]),s._v(" "),t("tr",[t("td",[s._v("Column")]),s._v(" "),t("td",[s._v("Field")]),s._v(" "),t("td",[s._v("字段（Field），就是JSON文档中的字段，类似数据库中的列（Column）")])]),s._v(" "),t("tr",[t("td",[s._v("Schema")]),s._v(" "),t("td",[s._v("Mapping")]),s._v(" "),t("td",[s._v("Mapping（映射）是索引中文档的约束，例如字段类型约束。类似数据库的表结构（Schema）")])]),s._v(" "),t("tr",[t("td",[s._v("SQL")]),s._v(" "),t("td",[s._v("DSL")]),s._v(" "),t("td",[s._v("DSL是elasticsearch提供的JSON风格的请求语句，用来操作elasticsearch，实现CRUD")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("是不是说，我们学习了elasticsearch就不再需要mysql了呢？\n并不是如此，两者各自有自己的擅长支出：")])]),s._v(" "),t("ul",[t("li",[s._v("Mysql：擅长事务类型操作，可以确保数据的安全和一致性")]),s._v(" "),t("li",[s._v("Elasticsearch：擅长海量数据的搜索、分析、计算")])]),s._v(" "),t("h2",{attrs:{id:"_2-索引库操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-索引库操作"}},[s._v("#")]),s._v(" 2. 索引库操作")]),s._v(" "),t("blockquote",[t("p",[s._v("索引库就类似数据库表，mapping映射就类似表的结构")])]),s._v(" "),t("h3",{attrs:{id:"_2-1-mapping映射属性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mapping映射属性"}},[s._v("#")]),s._v(" 2.1 mapping映射属性")]),s._v(" "),t("p",[s._v("mapping是对索引库中文档的约束，常见的mapping属性包括：")]),s._v(" "),t("ul",[t("li",[s._v("type：字段数据类型，常见的简单类型有：\n"),t("ul",[t("li",[s._v("字符串：text（可分词的文本）、keyword（精确值，例如：品牌、国家、ip地址）")]),s._v(" "),t("li",[s._v("数值：long、integer、short、byte、double、float、")]),s._v(" "),t("li",[s._v("布尔：boolean")]),s._v(" "),t("li",[s._v("日期：date")]),s._v(" "),t("li",[s._v("对象：object")])])]),s._v(" "),t("li",[s._v("index：是否创建索引，默认为true")]),s._v(" "),t("li",[s._v("analyzer：使用哪种分词器")]),s._v(" "),t("li",[s._v("properties：该字段的子字段")])]),s._v(" "),t("h3",{attrs:{id:"_2-2-索引库的crud"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-索引库的crud"}},[s._v("#")]),s._v(" 2.2 索引库的CRUD")]),s._v(" "),t("blockquote",[t("p",[s._v("这里我们统一使用 "),t("strong",[s._v("Kibana")]),s._v(" 编写DSL的方式来演示。")])]),s._v(" "),t("h4",{attrs:{id:"_2-2-1-创建索引库和映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-创建索引库和映射"}},[s._v("#")]),s._v(" 2.2.1 创建索引库和映射")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource@gh-pages/image/createIndex.5kafql65m4jk.webp",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_2-2-2-查询索引库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-查询索引库"}},[s._v("#")]),s._v(" 2.2.2 查询索引库")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource@gh-pages/image/image-20210720211019329.4zchxss0ie4g.webp",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_2-2-3-修改索引库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-修改索引库"}},[s._v("#")]),s._v(" 2.2.3 修改索引库")]),s._v(" "),t("p",[t("mark",[s._v("索引库一旦创建，无法修改mapping")])]),s._v(" "),t("blockquote",[t("p",[s._v("虽然无法修改mapping中已有的字段，但是却允许添加新的字段到mapping中，因为不会对倒排索引产生影响")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("PUT /索引库名/_mapping\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"新字段名"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"integer"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h4",{attrs:{id:"_2-2-4-删除索引库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-删除索引库"}},[s._v("#")]),s._v(" 2.2.4 删除索引库")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DELETE /索引库名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"_3-文档操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-文档操作"}},[s._v("#")]),s._v(" 3. 文档操作")]),s._v(" "),t("h3",{attrs:{id:"_3-1-新增文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-新增文档"}},[s._v("#")]),s._v(" 3.1 新增文档")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("POST /索引库名/_doc/文档id\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"子属性1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"子属性2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值4"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_3-2-查询文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-查询文档"}},[s._v("#")]),s._v(" 3.2 查询文档")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("GET /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("索引库名称"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/_doc/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-3-删除文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-删除文档"}},[s._v("#")]),s._v(" 3.3 删除文档")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DELETE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("索引库名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("_doc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("id值\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-4-修改文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-修改文档"}},[s._v("#")]),s._v(" 3.4 修改文档")]),s._v(" "),t("h4",{attrs:{id:"_3-4-1-全量修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-全量修改"}},[s._v("#")]),s._v(" 3.4.1.全量修改")]),s._v(" "),t("blockquote",[t("p",[s._v("全量修改是覆盖原来的文档，其本质是：根据指定的id删除文档, 再新增一个相同id的文档")])]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("：如果根据id删除时，id不存在，第二步的新增也会执行，也就从修改变成了新增操作了。")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("PUT /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("索引库名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/_doc/文档id\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段2"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"值2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ... 略")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"_3-4-2-增量修改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-增量修改"}},[s._v("#")]),s._v(" 3.4.2 增量修改")]),s._v(" "),t("blockquote",[t("p",[s._v("增量修改是只修改指定id匹配的文档中的部分字段。")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("POST /"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("索引库名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/_update/文档id\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"doc"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"字段名"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新的值"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"_4-restapi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-restapi"}},[s._v("#")]),s._v(" 4. RestAPI")]),s._v(" "),t("blockquote",[t("p",[s._v("ES官方提供了各种不同语言的客户端，用来操作ES。这些客户端的本质就是组装DSL语句，通过http请求发送给ES。官方文档地址：https://www.elastic.co/guide/en/elasticsearch/client/index.html")])]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("SpringBoot默认的ES版本是7.6.2，所以我们需要覆盖默认的ES版本")]),s._v(" "),t("li",[t("code",[s._v("JavaRestClient")]),s._v("操作elasticsearch的流程基本类似。核心是client.indices()方法来获取索引库的操作对象（client是"),t("code",[s._v("RestHighLevelClient")]),s._v("对象）")]),s._v(" "),t("li",[t("code",[s._v("BulkRequest")]),s._v(" 可以实现批量将数据库数据导入到索引库中")])])])}),[],!1,null,null,null);t.default=n.exports}}]);