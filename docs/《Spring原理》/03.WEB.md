---
title: WEB
date: 2024-01-05 
permalink: /pages/f344d070a1033aeh
author: cynicism
categories:
  - ã€ŠSpringåŸç†ã€‹
tags:
  - spring
---
## 1. SpringMVCé…ç½®æ–¹å¼
### 1.1 WEB-INF
åœ¨webå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨**WEB-INFæ–‡ä»¶å¤¹**ä¸‹å¯»æ‰¾åä¸º[servlet-name]-servlet.xmlçš„é…ç½®æ–‡ä»¶ä½œä¸ºSpringMVCçš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹springMVCçš„é…ç½®æ–‡ä»¶å°±æ˜¯æ”¾åœ¨WEB-INFä¸‹åä¸ºdispatcherServlet-servlet.xmlçš„é…ç½®æ–‡ä»¶
``` xml
<servlet>
    <servlet-name>dispatcherServlet</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>dispatcherServlet</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
```

### 1.2 ç±»è·¯å¾„
ç›´æ¥åœ¨ç±»è·¯å¾„ï¼ˆ**Resourceæ–‡ä»¶å¤¹**ï¼‰ä¸‹é…ç½®SpringMVCé…ç½®æ–‡ä»¶
``` xml
<servlet>  
    <servlet-name>DispatcherServlet</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>  
    <init-param>  
        <param-name>contextConfigLocation</param-name>  
        <param-value>classpath:springmvcconfig.xml</param-value>  
    </init-param>  
    <load-on-startup>1</load-on-startup>
    </servlet>  
    <servlet-mapping>  
        <servlet-name>DispatcherServlet</servlet-name>  
        <url-pattern>/</url-pattern>
    </servlet-mapping>  
```
åœ¨web.xmlä¸‹å¯ä»¥çœ‹åˆ° **DispatcherServlet** æ˜¯SpringMVCçš„æ ¸å¿ƒï¼Œä¸‹é¢å°†é‡ç‚¹è®²è§£DispatcherServletçš„åŸç†ä»¥åŠä½œç”¨ã€‚

## 2. SpringIOCå®¹å™¨å’ŒWebå®¹å™¨
<mark>SpringIOCæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œå®ƒå¹¶ä¸æ˜¯ç›´æ¥åœ¨Webå®¹å™¨ä¸­å‘æŒ¥ä½œç”¨çš„</mark>

å¦‚æœè¦åœ¨Webå®¹å™¨ä¸­ä½¿ç”¨IOCå®¹å™¨ï¼Œéœ€è¦Springä¸ºIOCè®¾è®¡ä¸€ä¸ªå¯åŠ¨è¿‡ç¨‹ï¼ŒæŠŠIOCå®¹å™¨å¯¼å…¥ï¼Œå¹¶å°†Webå®¹å™¨ä¸­å»ºç«‹èµ·æ¥ã€‚  

å…·ä½“æ¥è¯´ï¼ŒSpringIOCå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹æ˜¯å’ŒWebå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹é›†æˆåœ¨ä¸€èµ·çš„ã€‚åœ¨è¿™ä¸ªå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œ**ä¸€æ–¹é¢å¤„ç†Webå®¹å™¨çš„å¯åŠ¨ï¼Œå¦ä¸€æ–¹é¢å¤„ç†SpringIOCå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹**ï¼Œå¯¹äºSpringIOCå®¹å™¨çš„å¯åŠ¨è¿‡ç¨‹éœ€è¦è®¾è®¡ç‰¹å®šçš„**Webå®¹å™¨æ‹¦æˆªå™¨: ContextLoaderListener**ï¼Œå°†SpringIOCå®¹å™¨é›†æˆåˆ°Webå®¹å™¨ä¸­ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ã€‚  

å®Œæˆäº†ä¸Šè¿°è¿‡ç¨‹ï¼ŒSpringIOCå®¹å™¨æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè€ŒSpringMVCæ˜¯å»ºç«‹åœ¨IOCå®¹å™¨çš„åŸºç¡€ä¸Šçš„ï¼Œè¿™æ ·æ‰èƒ½å»ºç«‹èµ·MVCæ¡†æ¶çš„è¿è¡Œæœºåˆ¶ï¼Œä»è€Œå“åº”ä»å®¹å™¨ä¼ é€’çš„HTTPè¯·æ±‚ã€‚

## 3. ContextLoaderListener
è¿™æ˜¯ä¸€ä¸ªå®é™…é¡¹ç›®åœºæ™¯çš„springmvcçš„é…ç½®æ–‡ä»¶web.xml
![](https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource/img/img_06da42e16f9568866cad9fbcb78a5b52.png)
>contextConfigLocation å¯¹åº”çš„valueæ˜¯Springé…ç½®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
>ç›‘å¬å™¨ä¸»è¦ç”¨æ¥å¯¹Servletå®¹å™¨(è¿™é‡ŒæŒ‡Tomcat)çš„è¡Œä¸ºè¿›è¡Œç›‘å¬ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨**ContextLoaderListener**

:::note
ContextLoaderListener ç»§æ‰¿è‡ª ContextLoader,å¹¶ä¸”è¿˜å®ç°äº† ServletContextListener å¹¶ä¸”å®ƒçš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†ä¸€ä¸ªWebApplicationContext,å®ƒæ˜¯ç»§æ‰¿è‡ªApplicationContextæ¥å£çš„é«˜çº§IoCå®¹å™¨
:::

ğŸ”ServletContextListener æ˜¯ Servlet ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ¥å£:**ç›‘å¬ Servlet å®¹å™¨çš„å¯åŠ¨å’Œé”€æ¯äº‹ä»¶** 

æ‰€ä»¥åœ¨ ContextLoaderListener ä¸­ï¼š
- **contextInitializedæ–¹æ³•** ï¼šå‚æ•°ä¸ºæ‰€è¦ç›‘å¬çš„ServletContextEventï¼Œä¹Ÿå°±æ˜¯**Tomcatå¯åŠ¨åŠ è½½å®Œweb.xmlä¼šäº§ç”Ÿçš„äº‹ä»¶**ï¼ŒServletContextEvent æŒæœ‰ä»web.xmlåŠ è½½çš„åˆå§‹åŒ–é…ç½®çš„ ServletContext ä¸Šä¸‹æ–‡

- **contextDestroyedæ–¹æ³•** ï¼šåœ¨**Tomcatå…³é—­**çš„æ—¶å€™æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå¯åŠ¨æ—¶ï¼ŒServletContextListener çš„æ‰§è¡Œé¡ºåºä¸web.xmlä¸­çš„é…ç½®é¡ºåºä¸€è‡´ï¼Œåœæ­¢æ—¶æ‰§è¡Œé¡ºåºæ­£ç›¸å

>**æ¢³ç†æµç¨‹** 
å½“Servletå®¹å™¨å¯åŠ¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°†è¢«ContextLoaderLister ç›‘å¬ã€‚æ­¤æ—¶ ContextLoaderListener ä¼šè°ƒç”¨å®ç° ServletContextListener æ¥å£åå®ç°çš„ **contextInitialized** æ–¹æ³•ï¼Œå¹¶æŠŠåœ¨web.xmlåŠ è½½åˆå§‹åŒ–åè·å–çš„ ServletContext ä¼ å…¥**initWebApplicationContext**æ–¹æ³•ä¸­è¿›è¡ŒIoCå®¹å™¨çš„åˆå§‹åŒ–

## 4. Spring IOCå®¹å™¨åˆå§‹åŒ–
>ä¸»è¦æ˜¯é€šè¿‡ **initWebApplicationContext**æ–¹æ³•å¯¹IOCå®¹å™¨è¿›è¡Œåˆå§‹åŒ–

![](https://cdn.jsdelivr.net/gh/Cynicism-lab/MyResource/img/spring-14.jpg)

```java
public WebApplicationContext initWebApplicationContext(ServletContext servletContext) {
        // åˆ¤æ–­åœ¨webå®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨WebApplicationContextï¼Œå› ä¸ºåœ¨é…ç½®ä¸­åªå…è®¸ç”³æ˜ä¸€æ¬¡ServletContextListenerï¼Œå¤šæ¬¡å£°æ˜ä¼šæ‰°ä¹±Springçš„æ‰§è¡Œé€»è¾‘ã€‚
	if (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != null) //æŠ›å‡ºå¼‚å¸¸
	// 1. åˆ›å»ºWebApplicationContext
	if (this.context == null) {
		this.context = createWebApplicationContext(servletContext);
	}
	// ç¡®ä¿è¯¥å®¹å™¨æ˜¯å¯é…ç½®çš„webå®¹å™¨
	if (this.context instanceof ConfigurableWebApplicationContext) {
		ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) this.context;
		if (!cwac.isActive()) {
			// ä¸Šä¸‹æ–‡å°šæœªåˆ·æ–° - >æä¾›è¯¸å¦‚è®¾ç½®çˆ¶ä¸Šä¸‹æ–‡ï¼Œè®¾ç½®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡IDç­‰æœåŠ¡
			if (cwac.getParent() == null) {
				// åœ¨Webå®¹å™¨ä¸­å»ºç«‹èµ·åŒäº²IOCå®¹å™¨
				ApplicationContext parent = loadParentContext(servletContext);
				cwac.setParent(parent);
			}
			// 2. ç»è¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼Œç°åœ¨å¼€å§‹é…ç½®å¹¶åˆå§‹åŒ–WebApplicationContextã€‚
			configureAndRefreshWebApplicationContext(cwac, servletContext);
		}
	}
   // 3. å°†å·²ç»å®Œæˆåˆå§‹åŒ–çš„XmlWebApplicationContextå®¹å™¨æ³¨å†Œåˆ°servletContextä¸­å»
	servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, this.context);
	return this.context;
}
```

1. è°ƒç”¨ContextLoaderListenerä¸­çš„initWebApplicationContextæ–¹æ³•å¹¶ä¸”å°†è·å–åˆ°çš„servletContextä½œä¸ºå‚æ•°ä¼ å…¥
2. initWebApplicationContexté¦–å…ˆä¼šå°è¯•ä»servletContextä¸­**è·å–æ ¹å®¹å™¨(IOCå®¹å™¨ï¼‰**ï¼Œå¦‚æœå®¹å™¨ä¸ä¸ºç©ºï¼Œåˆ™å®¹å™¨åˆå§‹åŒ–å¤±è´¥,å› ä¸ºweb.xmlä¸­å¯èƒ½å®šä¹‰äº†å¤šä¸ªIoCå®¹å™¨çš„åŠ è½½å™¨ã€‚å‡å¦‚æ­¤æ—¶å®¹å™¨è¿˜æœªåˆå§‹åŒ–ï¼Œåˆ™è°ƒç”¨**createWebApplicationContext**æ–¹æ³•åˆ›å»ºä¸€ä¸ªIOCå®¹å™¨(é»˜è®¤æ˜¯`XMLWebApplicationContext`)ã€‚
3. åˆ›å»ºå®Œå®¹å™¨ä¹‹åï¼Œå°†ä¼šè°ƒç”¨ä¸€ä¸ªéå¸¸é‡è¦çš„**configureAndRefreshWebApplicationContext**æ–¹æ³•ã€‚åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†ä»ApplicationContext.xmlé…ç½®æ–‡ä»¶ä¸­è·å–åˆ°çš„å†…å®¹é…ç½®åˆ°å·²ç»åˆ›å»ºå¥½äº†çš„XmlWebApplicationContextå®¹å™¨ä¸­å»ï¼Œå¹¶è°ƒç”¨**refreshæ–¹æ³•æ¥å®ŒæˆIOCå®¹å™¨çš„åˆå§‹åŒ–**ã€‚
4. ç„¶åï¼Œå†å°†å·²ç»å®Œæˆåˆå§‹åŒ–çš„XmlWebApplicationContextå®¹å™¨æ³¨å†Œåˆ°servletContextä¸­å»ã€‚

>å…¶å®åœ¨Webå®¹å™¨ä¸­ï¼ŒServletContextä¸ºSpringçš„IoCå®¹å™¨æä¾›äº†å®¿ä¸»ç¯å¢ƒï¼Œå¯¹åº”çš„å»ºç«‹èµ·ä¸€ä¸ªIoCå®¹å™¨çš„ä½“ç³»ã€‚å…¶ä¸­ï¼Œé¦–å…ˆéœ€è¦å»ºç«‹çš„æ˜¯æ ¹ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡æŒæœ‰çš„å¯¹è±¡å¯ä»¥æœ‰ä¸šåŠ¡å¯¹è±¡ã€æ•°æ®å­˜å–å¯¹è±¡ã€èµ„æºã€äº‹åŠ¡ç®¡ç†å™¨ç­‰å„ç§ä¸­é—´å±‚å¯¹è±¡ã€‚
>
>åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡çš„åŸºç¡€ä¸Šï¼Œä¸Web MVCç›¸å…³è¿˜ä¼šæœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡æ¥ä¿æŒæ§åˆ¶å™¨ä¹‹ç±»çš„MVCå¯¹è±¡ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„ä¸Šä¸‹æ–‡ç»“æ„ã€‚å› ä¸ºåœ¨initWebApplicationContextæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®åˆ›å»ºApplicationContextå®¹å™¨çš„å·¥ä½œæ˜¯äº¤ç”±createWebApplicationContextæ–¹æ³•æ¥å®ç°çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•

## 5. createWebApplicationContext
```java
protected WebApplicationContext createWebApplicationContext(ServletContext sc) {
		// è¿™é‡Œåˆ¤æ–­ä½¿ç”¨ä»€ä¹ˆæ ·çš„ç±»åœ¨Webå®¹å™¨ä¸­ä½œä¸ºIOCå®¹å™¨
		Class<?> contextClass = determineContextClass(sc);
		if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) {
			throw new ApplicationContextException("Custom context class [" + contextClass.getName() +
					"] is not of type [" + ConfigurableWebApplicationContext.class.getName() + "]");
		}
		// ç›´æ¥å®ä¾‹åŒ–éœ€è¦äº§ç”Ÿçš„IOCå®¹å™¨,é»˜è®¤çš„æ˜¯`XMLWebApplicationContext`
		return (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);
	}

protected Class<?> determineContextClass(ServletContext servletContext) {
		String contextClassName = servletContext.getInitParameter(CONTEXT_CLASS_PARAM);
		// åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„IOC  
                if{...}
		else {
			// å¦‚æœæ²¡æœ‰æŒ‡å®šçš„IOCå®¹å™¨ï¼Œåˆ™propertiesä¸­è·å–é»˜è®¤çš„IOCå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯XMLWebApplicationContext
			contextClassName = defaultStrategies.getProperty(WebApplicationContext.class.getName());
			return ClassUtils.forName(contextClassName, ContextLoader.class.getClassLoader());
		}
	}
```
æ­¤æ–¹æ³•åŠŸèƒ½

- å†³å®šè¦åˆ›å»ºçš„ApplicationContextç±»å‹
- å®ä¾‹åŒ–ä¸€ä¸ªApplicationContext

>é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å†³å®šè¦åˆ›å»ºçš„ApplicationContextç±»å‹çš„å‘¢ï¼Ÿ

èµ·ä½œç”¨çš„æ˜¯determineContextClassæ–¹æ³•


## 6. mvc å¤„ç†æµç¨‹

å½“æµè§ˆå™¨å‘é€ä¸€ä¸ªè¯·æ±‚ `http://localhost:8080/hello` åï¼Œè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œå…¶å¤„ç†æµç¨‹æ˜¯ï¼š

1. æœåŠ¡å™¨æä¾›äº† DispatcherServletï¼Œå®ƒä½¿ç”¨çš„æ˜¯æ ‡å‡† Servlet æŠ€æœ¯

   * è·¯å¾„ï¼šé»˜è®¤æ˜ å°„è·¯å¾„ä¸º `/`ï¼Œå³ä¼šåŒ¹é…åˆ°æ‰€æœ‰è¯·æ±‚ URLï¼Œå¯ä½œä¸ºè¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸º**å‰æ§åˆ¶å™¨**
     * jsp ä¸ä¼šåŒ¹é…åˆ° DispatcherServlet
     * å…¶å®ƒæœ‰è·¯å¾„çš„ Servlet åŒ¹é…ä¼˜å…ˆçº§ä¹Ÿé«˜äº DispatcherServlet
   * åˆ›å»ºï¼šåœ¨ Boot ä¸­ï¼Œç”± DispatcherServletAutoConfiguration è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æä¾› DispatcherServlet çš„ bean
   * åˆå§‹åŒ–ï¼šDispatcherServlet åˆå§‹åŒ–æ—¶ä¼šä¼˜å…ˆåˆ°å®¹å™¨é‡Œå¯»æ‰¾å„ç§ç»„ä»¶ï¼Œä½œä¸ºå®ƒçš„æˆå‘˜å˜é‡
     * HandlerMappingï¼Œåˆå§‹åŒ–æ—¶è®°å½•æ˜ å°„å…³ç³»
     * HandlerAdapterï¼Œåˆå§‹åŒ–æ—¶å‡†å¤‡å‚æ•°è§£æå™¨ã€è¿”å›å€¼å¤„ç†å™¨ã€æ¶ˆæ¯è½¬æ¢å™¨
     * HandlerExceptionResolverï¼Œåˆå§‹åŒ–æ—¶å‡†å¤‡å‚æ•°è§£æå™¨ã€è¿”å›å€¼å¤„ç†å™¨ã€æ¶ˆæ¯è½¬æ¢å™¨
     * ViewResolver
2. DispatcherServlet ä¼šåˆ©ç”¨ RequestMappingHandlerMapping æŸ¥æ‰¾æ§åˆ¶å™¨æ–¹æ³•

   * ä¾‹å¦‚æ ¹æ® /hello è·¯å¾„æ‰¾åˆ° @RequestMapping("/hello") å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•

   * æ§åˆ¶å™¨æ–¹æ³•ä¼šè¢«å°è£…ä¸º HandlerMethod å¯¹è±¡ï¼Œå¹¶ç»“åˆåŒ¹é…åˆ°çš„æ‹¦æˆªå™¨ä¸€èµ·è¿”å›ç»™ DispatcherServlet 

   * HandlerMethod å’Œæ‹¦æˆªå™¨åˆåœ¨ä¸€èµ·ç§°ä¸º HandlerExecutionChainï¼ˆè°ƒç”¨é“¾ï¼‰å¯¹è±¡
3. DispatcherServlet æ¥ä¸‹æ¥ä¼šï¼š

   1. è°ƒç”¨æ‹¦æˆªå™¨çš„ preHandle æ–¹æ³•
   2. RequestMappingHandlerAdapter è°ƒç”¨ handle æ–¹æ³•ï¼Œå‡†å¤‡æ•°æ®ç»‘å®šå·¥å‚ã€æ¨¡å‹å·¥å‚ã€ModelAndViewContainerã€å°† HandlerMethod å®Œå–„ä¸º ServletInvocableHandlerMethod
      * @ControllerAdvice å…¨å±€å¢å¼ºç‚¹1ï¸âƒ£ï¼šè¡¥å……æ¨¡å‹æ•°æ®
      * @ControllerAdvice å…¨å±€å¢å¼ºç‚¹2ï¸âƒ£ï¼šè¡¥å……è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨
      * ä½¿ç”¨ HandlerMethodArgumentResolver å‡†å¤‡å‚æ•°
        * @ControllerAdvice å…¨å±€å¢å¼ºç‚¹3ï¸âƒ£ï¼šRequestBody å¢å¼º
      * è°ƒç”¨ ServletInvocableHandlerMethod 
      * ä½¿ç”¨ HandlerMethodReturnValueHandler å¤„ç†è¿”å›å€¼
        * @ControllerAdvice å…¨å±€å¢å¼ºç‚¹4ï¸âƒ£ï¼šResponseBody å¢å¼º
      * æ ¹æ® ModelAndViewContainer è·å– ModelAndView
        * å¦‚æœè¿”å›çš„ ModelAndView ä¸º nullï¼Œä¸èµ°ç¬¬ 4 æ­¥è§†å›¾è§£æåŠæ¸²æŸ“æµç¨‹
          * ä¾‹å¦‚ï¼Œæœ‰çš„è¿”å›å€¼å¤„ç†å™¨è°ƒç”¨äº† HttpMessageConverter æ¥å°†ç»“æœè½¬æ¢ä¸º JSONï¼Œè¿™æ—¶ ModelAndView å°±ä¸º null
        * å¦‚æœè¿”å›çš„ ModelAndView ä¸ä¸º nullï¼Œä¼šåœ¨ç¬¬ 4 æ­¥èµ°è§†å›¾è§£æåŠæ¸²æŸ“æµç¨‹
   3. è°ƒç”¨æ‹¦æˆªå™¨çš„ postHandle æ–¹æ³•
   4. å¤„ç†å¼‚å¸¸æˆ–è§†å›¾æ¸²æŸ“
      * å¦‚æœ 1~3 å‡ºç°å¼‚å¸¸ï¼Œèµ° ExceptionHandlerExceptionResolver å¤„ç†å¼‚å¸¸æµç¨‹
        * @ControllerAdvice å…¨å±€å¢å¼ºç‚¹5ï¸âƒ£ï¼š@ExceptionHandler å¼‚å¸¸å¤„ç†
      * æ­£å¸¸ï¼Œèµ°è§†å›¾è§£æåŠæ¸²æŸ“æµç¨‹
   5. è°ƒç”¨æ‹¦æˆªå™¨çš„ afterCompletion æ–¹æ³•
